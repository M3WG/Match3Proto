const m3={component:{},model:{},utility:{}};m3.utility.array={},m3.utility.array.copy=(t=>Array.isArray(t)?[].slice.call(t):[]),m3.utility.array.randomIndex=(t=>{if(Array.isArray(t))return Math.floor(Math.random()*t.length)}),m3.utility.array.randomValue=(t=>{if(Array.isArray(t)){return t[m3.utility.array.randomIndex(t)]}}),m3.utility.array.reverse=(t=>m3.utility.array.copy(t).reverse()),m3.utility.array.shuffle=(t=>{for(let e=(t=m3.utility.array.copy(t)).length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}return t}),m3.utility.array.unique=(t=>[...Set(t)]),m3.utility.dom={},m3.utility.dom.contains=((t,e)=>{do{if(!(e instanceof Node))return!1;if(e===t)return!0}while(e=e.parentNode);return!1}),m3.utility.dom.createElement=((t,{assign:e,attrs:i,children:n,data:r,listeners:o,props:s,parent:a,style:l,then:c})=>{const u=document.createElement(t);if(Array.isArray(e)){const[t,i]=e;t&&(t[i]=u)}for(let t in i)i.hasOwnProperty(t)&&u.setAttribute(t,i[t]);Array.isArray(n)&&n.forEach(t=>{m3.utility.component.is(t)?t.attach(u):("string"==typeof t&&(t=document.createTextNode(t)),u.appendChild(t))});for(let t in r)r.hasOwnProperty(t)&&(u.dataset[t]=r[t]);Array.isArray(o)&&o.forEach(([...t])=>{u.addEventListener(...t)}),a instanceof Node&&a.appendChild(u);for(let t in s)s.hasOwnProperty(t)&&t in u&&(u[t]=s[t]);for(let t in l)l.hasOwnProperty(t)&&t in u.style&&(u.style[t]=l[t]);return"function"==typeof c&&c(u),u}),m3.utility.fn={compose:(...t)=>e=>t.reduceRight((t,e)=>e(t),e),const:t=>()=>t,identity:()=>t=>t,pipe:(...t)=>e=>t.reduce((t,e)=>e(t),e),unary:t=>e=>t(e)},m3.utility.matrix={},m3.utility.matrix.flip=(t=>t[0].map((e,i)=>t.map(t=>t[i]))),m3.utility.matrix.rotate90=m3.utility.fn.pipe(m3.utility.array.reverse,m3.utility.matrix.flip),m3.utility.matrix.rotate180=(t=>m3.utility.array.reverse(t.map(m3.utility.array.reverse))),m3.utility.matrix.rotate270=m3.utility.fn.pipe(m3.utility.matrix.flip,m3.utility.array.reverse),m3.utility.pubsub={},m3.utility.pubsub.create=function(...t){return Object.create(this.prototype).create(...t)},m3.utility.pubsub.decorate=function(t,e){return this.is(e)||(e=this.create()),t.pubsub=e,["emit","off","on"].forEach(i=>{t[i]=((...n)=>(e[i](...n),t))}),t},m3.utility.pubsub.is=function(t){return this.prototype.isPrototypeOf(t)},m3.utility.pubsub.prototype={create:function(){return this._handler={},this},destroy:function(){return this.off(),this},emit:function(t,...e){if(!this._handler[t])return this;return this._handler[t].forEach(t=>t(...e)),this},off:function(t,e){if(void 0===t)return this._handler={},this;if(void 0===e)return delete this._handler[t],this;if(!this._handler[t])return this;const i=this._handler[t],n=i.indexOf(e);return-1!=n&&i.splice(n,1),this},on:function(t,e){return this._handler[t]||(this._handler[t]=[]),this._handler[t].push(e),this}},m3.utility.adjacency={},m3.utility.adjacency.getCells=(t=>{const e=t.getMap(),i=t.getX(),n=t.getY();return[t,e.getCell(i+1,n),e.getCell(i-1,n),e.getCell(i,n+1),e.getCell(i,n-1)].filter(t=>m3.model.cell.is(t))}),m3.utility.adjacency.getSimilarCells=(t=>m3.utility.adjacency.getCells(t).filter(e=>e.getTile()==t.getTile())),m3.utility.adjacency.getSimilarCellsGreedy=((t,e)=>{"function"!=typeof e&&(e=m3.utility.fn.identity());const i=m3.utility.adjacency.getSimilarCells,n=i(t).filter(e),r=[];let o;do{o=!1,n.forEach(t=>{r.includes(t)||i(t).forEach(t=>{e(t)&&!n.includes(t)&&(n.push(t),o=!0)})})}while(o);return n}),m3.utility.adjacency.getPaths=((t,e)=>m3.utility.adjacency.getSimilarCellsGreedy(t,e).reduce((t,i)=>(t.includes(i)||m3.utility.adjacency.getCells(i).forEach(i=>{t.includes(i)||t.push(...m3.utility.adjacency.getSimilarCellsGreedy(i,e))}),t),[])),m3.utility.adjacency.getPathsGreedy=((t,e)=>{const i=t=>m3.utility.adjacency.getPaths(t,e),n=i(t),r=[];let o;do{o=!1,n.forEach(t=>{r.includes(t)||i(t).forEach(t=>{n.includes(t)||(n.push(t),o=!0)})})}while(o);return n}),m3.utility.component={},m3.utility.component.extend=((t,e={})=>{if(!m3.utility.component.is(t))throw new Error("Please provide a valid component");return Object.keys(e).forEach(i=>t[i]=e[i]),t}),m3.utility.component.extendDelegate=((t,e)=>{if("function"!=typeof e)throw new Error("Please provide a valid function");return m3.utility.component.extend(t,e(t))}),m3.utility.component.factory=((t,e={})=>({create:function(...t){return Object.create(this.prototype).create(...t)},is:function(t){return this.prototype.isPrototypeOf(t)},prototype:t,...e})),m3.utility.component.invent=((t={},e)=>Object.setPrototypeOf({...t},m3.utility.component.is(e)?e:m3.component.base.prototype)),m3.utility.component.inventFactory=((t,e={},i)=>m3.utility.component.factory(m3.utility.component.invent(t,i),e)),m3.utility.component.is=(t=>m3.component.base.prototype.isPrototypeOf(t)),m3.utility.crawler={},m3.utility.crawler.create=function(...t){return Object.create(this.prototype).initialize(...t)},m3.utility.crawler.prototype={getAdjacent:function(){return[this.getDown(),this.getLeft(),this.getRight(),this.getUp()].filter(t=>m3.model.cell.is(t))},getDown:function(){const t=this.getX(),e=this.getY()-1;return this.getMap().getCell(t,e)},getFirst:function(t){"function"!=typeof t&&(t=m3.utility.fn.identity());const e=this.getAdjacent();for(let i in e)if(t(i))return i},getLeft:function(){const t=this.getX()-1,e=this.getY();return this.getMap().getCell(t,e)},getMap:function(){return this.map},getRight:function(){const t=this.getX()+1,e=this.getY();return this.getMap().getCell(t,e)},getPriority:function(t){"function"!=typeof t&&(filter=m3.utility.fn.identity());const e=this.getAdjacent();let i,n=-1/0;for(let r in e){const e=t(r);e>n&&(i=r,n=e)}return i},getUp:function(){const t=this.getX(),e=this.getY()+1;return this.getMap().getCell(t,e)},getX:function(){return this.x},getY:function(){return this.y},initialize:function({cell:t,map:e,x:i,y:n}){return m3.model.cell.is(t)?this.moveToCell(t):(this.setMap(e),this.moveTo(i,n),this)},moveDown:function(){return this.setY(this.getY()+1)},moveFirst:function(t){const e=this.getFirst(t);return e&&this.moveToCell(e),this},moveLeft:function(){return this.setX(this.getX()-1)},movePriority:function(t){const e=this.getPriority(t);return e&&this.moveToCell(e),this},moveRight:function(){return this.setX(this.getX()+1)},moveTo:function(t,e){return this.setX(t).setY(e)},moveToCell:function(t){if(!m3.model.cell.is(t))throw new Error("Please provide a valid cell");return this.setMap(t.getMap()).setX(t.getX()).setY(t.getY())},moveUp:function(){return this.setY(this.getY()-1)},setMap:function(t){if(!m3.model.map.is(t))throw new Error("Please provide a valid map");return this.map=t,this},setX:function(t){return this.x=Number(t)||0,this},setY:function(t){return this.y=Number(t)||0,this}},m3.utility.map={},m3.utility.map.fill=((t,e)=>(t.getCells().forEach(t=>{t.setTile(e)}),this)),m3.utility.map.getPercent=((t,e)=>{"function"!=typeof e&&(e=m3.utility.fn.identity());const i=t.getCells();return i.filter(e).length/i.length}),m3.utility.map.import=((t,e)=>{t.getCells().forEach(t=>{const i=t.getX(),n=t.getY();t.setTile(e[n][i])})}),m3.utility.map.randomize=(t=>{const e=m3.utility.array.shuffle(m3.model.tile.getAll().reduce((t,e)=>[...t,...Array(e.getRandomWeight()).fill(e)],[]));t.getCells().forEach(t=>t.setTile(m3.utility.array.randomValue(e)))}),m3.utility.match={},m3.utility.match.shape=((t,{definition:e=[],mirror:i=!1,rotate:n=!1},r)=>{const o=t.getX(),s=t.getY(),a=t.getMap();"function"!=typeof r&&(r=m3.utility.fn.identity());const l=[e];for(let t=1,i=e.length;t<i;t++){const[i,n]=e[t],r=([t,e,...r])=>[t-i,e-n,...r];l.push(e.map(r))}i&&l.slice().forEach(t=>{l.push(t.map(([t,e,...i])=>[-t,e,...i]),t.map(([t,e,...i])=>[t,-e,...i]))}),n&&l.slice().forEach(t=>{l.push(t.map(([t,e,...i])=>[-e,t,...i]),t.map(([t,e,...i])=>[e,t,...i]),t.map(([t,e,...i])=>[e,-t,...i]))});const c=t=>{for(let[e,i,...n]of t){const t=a.getCell(o+e,s+i);if(!r(t,...n))return!1}return!0},u=t=>t.map(([t,e])=>a.getCell(o+t,s+e));for(const t of l)if(c(t))return u(t)}),m3.utility.match.shapes=((t,e,i)=>{for(const n of e){const e=m3.utility.match.shape(t,n,i);if(e)return e}}),m3.utility.model={},m3.utility.model.extend=((t,e={})=>{if(!m3.utility.model.is(t))throw new Error("Please provide a valid model");return Object.keys(e).forEach(i=>{let n=e[i];"defaults"!=i&&"validators"!=i||(n={...t[i],...n}),t[i]=n}),t}),m3.utility.model.extendDelegate=((t,e)=>{if("function"!=typeof e)throw new Error("Please provide a valid function");return m3.utility.model.extend(t,e(t))}),m3.utility.model.factory=((t,e={})=>({create:function(...t){return Object.create(this.prototype).create(...t)},is:function(t){return this.prototype.isPrototypeOf(t)},prototype:t,...e})),m3.utility.model.invent=((t={},e)=>(e=m3.utility.model.is(e)?e:m3.model.base.prototype,Object.setPrototypeOf({...t,defaults:{...e.defaults,...t.defaults},validators:{...e.validators,...t.validators}},e))),m3.utility.model.inventFactory=((t,e={},i)=>m3.utility.model.factory(m3.utility.model.invent(t,i),e)),m3.utility.model.inventSingletonFactory=((t,e={},i)=>m3.utility.model.singletonFactory(m3.utility.model.invent(t,i),e)),m3.utility.model.is=(t=>m3.model.base.prototype.isPrototypeOf(t)),m3.utility.model.singletonFactory=((t,e={})=>m3.utility.model.factory(t,{data:{},get:function(t){if(this.is(t))return t;if(this.store.has(t))return this.store.get(t);const e=this.data[t]||{};e.id=t;const i=this.create(e);return this.store.set(t,i),i},getSome:function(t){return t.map(t=>this.get(t))},getAll:function(){return Object.keys(this.data).map(t=>this.get(t))},store:new Map,...e})),m3.component.base={},m3.component.base.prototype={attach:function(t){return t instanceof Node&&t.appendChild(this.rootElement),this},create:function({parentComponent:t,parentElement:e,...i},...n){return this.data=i,this.parent=t,m3.utility.pubsub.decorate(this),this.setup(...n).attach(e),this},destroy:function(){return this.teardown(),this.pubsub.destroy(),this.data={},this},detach:function(t){return this.rootElement&&this.rootElement.parentNode instanceof Node&&this.rootElement.parentNode.removeChild(this.rootElement),this},getBoundingClientRect:function(){return this.rootElement instanceof Element?this.rootElement.getBoundingClientRect():{}},setup:function(){return this},teardown:function(){return this}},m3.component.cell=m3.utility.component.inventFactory((()=>{function t(t){t.preventDefault(),t.stopPropagation(),this.click()}return{click:function(){return this.emit("click"),this},getModel:function(){return this.data.model},getX:function(){return this.data.x},getY:function(){return this.data.y},setup:function(){const e=m3.utility.dom.createElement;return this.rootElement=e("button",{props:{className:"m3-c-cell",type:"button"},listeners:[["click",t.bind(this)]],children:[e("div",{assign:[this,"_icon"],props:{className:"m3-c-cell--icon"}})]}),this.data.model&&this.data.model.on("change",this.update.bind(this)),this.update(),this},update:function(){const t=this.getModel().getTile();return this.rootElement.style.backgroundColor=t?t.getColor():"transparent",this.rootElement.setAttribute("data-tile",t?t.getId():-1),this._icon.innerHTML=t?t.getIcon():"",this}}})()),m3.component.map=m3.utility.component.inventFactory({getCell:function(t,e){if(this._cell[e])return this._cell[e][t]},getCells:function(){return this._cell.reduce((t,e)=>(t.push(...e),t),[])},getModel:function(){return this.data.model},setup:function(){this._cell=[];const t=m3.utility.dom.createElement;this.rootElement=t("div",{props:{className:"m3-c-map"},children:[t("table",{assign:[this,"_table"],props:{className:"m3-c-map--table",cellSpacing:0}})]});const e=this.getModel();if(!e)return;const i=e.getHeight(),n=e.getWidth();for(let e=0;e<i;e++){const i=t("tr",{parent:this._table,properties:{className:"m3-c-map--row"}});this._cell[e]=[];for(let r=0;r<n;r++){const n=t("td",{parent:i,properties:{className:"m3-c-map--cell"}});this._cell[e][r]=m3.component.cell.create({model:map.getCell(r,e),parentComponent:this,parentElement:n,x:r,y:e})}}return this.update(),this},teardown:function(){const t=t=>t.destroy();return this._cell.forEach(e=>e.forEach(t)),this},update:function(){return this._cell.forEach(function(t){t.forEach(function(t){t.update()})}),this}}),m3.component.minimap=m3.utility.component.inventFactory({setup:function(){return this.rootElement=document.createElement("div"),this.rootElement.className="m3-c-minimap",this}}),m3.component.scoreboard=m3.utility.component.inventFactory({setup:function(){const t=m3.utility.dom.createElement;return this.rootElement=t("div",{props:{className:"m3-c-scoreboard"},children:[t("ul",{parent:this.rootElement,props:{className:"m3-c-scoreboard--players"},then:t=>{this._player=this.data.players.filter(t=>m3.model.player.is(t)).map(e=>m3.component.scoreboardPlayer.create({model:e,parentComponent:this,parentElement:t}))}})]}),this},teardown:function(){return this._player.forEach(t=>t.destroy()),this}}),m3.component.scoreboardPlayer=m3.utility.component.inventFactory({getModel:function(){return this.data.model},setup:function(){const t=m3.utility.dom.createElement;this.rootElement=t("li",{props:{className:"m3-c-scoreboard--player"},children:[t("div",{assign:[this,"_color"],props:{className:"m3-c-scoreboard--playerColor"}}),t("div",{assign:[this,"_name"],props:{className:"m3-c-scoreboard--playerName"}}),t("div",{assign:[this,"_score"],props:{className:"m3-c-scoreboard--playerScore"}})]});const e=this.getModel();return e&&e.on("change",this.update.bind(this)),this.update(),this},update:function(){const t=this.getModel();return this._color.style.backgroundColor=t.getColor(),this._name.innerHTML=t.getName(),this._score.innerHTML=t.getScore(),this}}),m3.component.tilePicker=m3.utility.component.inventFactory({getOption:function(t){return this._option[t]},getOptionIndex:function(t){return this._option.indexOf(t)},getOptions:function(){return m3.utility.array.copy(this._option)},getSelectedIndex:function(){for(let t=0,e=this._option.length;t<e;t++)if(this._option[t].isSelected())return t;return 0},getValue:function(){const t=this.getSelectedIndex(),e=this.getOption(t);if(e)return e.getValue()},setSelectedIndex:function(t){return this._option.forEach((e,i)=>{const n=i===t,r=e.isSelected();r&&!n&&e.setSelected(!1),n&&!r&&e.setSelected(!0)}),this},setup:function(){const t=m3.utility.dom.createElement;return this.rootElement=t("div",{props:{className:"m3-c-tilePicker"},children:[t("ul",{props:{className:"m3-c-tilePicker--options"},children:[t("ul",{props:{className:"m3-c-tilePicker--options"},then:e=>{this._option=this.data.option.filter(t=>t&&m3.model.tile.is(t.tile)).map(i=>m3.component.tilePickerOption.create({parentComponent:this,...i}).attach(t("li",{parent:e,props:{className:"m3-c-tilePicker--option"}})))}})]})]}),this.setSelectedIndex(0),this},teardown:function(){return this._option.forEach(t=>t.destroy()),this}}),m3.component.tilePickerOption=m3.utility.component.inventFactory((()=>{function t(t){t.preventDefault(),t.stopPropagation(),this.click()}return{click:function(){const t=this.parent.getOptionIndex(this);return this.parent.setSelectedIndex(t),this},getValue:function(){return this.data.tile},isDisabled:function(){return this.rootElement.classList.contains("m3-c-tilePickerOption-disabled")},isSelected:function(){return this.rootElement.classList.contains("m3-c-tilePickerOption-selected")},setInventory:function(t){(t=Math.max(0,t)||0)!=1/0&&t!=-1/0||(t="∞"),this._inventory.innerHTML=t;const e=this.isDisabled();return e||t?e&&t&&this.setDisabled(!1):this.setDisabled(!0),this},setDisabled:function(t){return t?this.rootElement.classList.add("m3-c-tilePickerOption-disabled"):this.rootElement.classList.remove("m3-c-tilePickerOption-disabled"),this},setSelected:function(t){return t?this.rootElement.classList.add("m3-c-tilePickerOption-selected"):this.rootElement.classList.remove("m3-c-tilePickerOption-selected"),this},setup:function(){const e=m3.utility.dom.createElement,i=this.getValue();return this.rootElement=e("button",{props:{className:"m3-c-tilePickerOption"},listeners:[["click",t.bind(this)]],children:[e("div",{props:{className:"m3-c-tilePickerOption--color"},style:{backgroundColor:i.getColor()}}),e("div",{props:{className:"m3-c-tilePickerOption--icon",innerHTML:i.getIcon()}}),e("div",{props:{className:"m3-c-tilePickerOption--label",innerHTML:i.getName()}}),e("div",{assign:[this,"_inventory"],props:{className:"m3-c-tilePickerOption--inventory"}})]}),this}}})()),m3.model.base={},m3.model.base.prototype={create:function(t,...e){return t={...this.defaults,...t},Object.keys(this.validators).forEach(e=>t[e]=this.validate(e,t[e])),this.data=t,m3.utility.pubsub.decorate(this),this.setup(...e),this},defaults:{},destroy:function(){return this.teardown(),this.pubsub.destroy(),this.data={},this},has:function(t){return void 0!==this.data[t]},get:function(t){return this.data[t]},getId:function(){return this.data.id},is:function(t,e,i){return i?this.data[t]===e:this.data[t]==e},reset:function(){return this.data={...this.defaults},this.emit("change"),this},set:function(t,e){return this.data[t]=this.validate(t,e),this.emit("change"),this},setup:function(){return this},teardown:function(){return this},validate:function(t,e){return"function"==typeof this.validators[t]&&(e=this.validators[t](e)),e},validators:{}},m3.model.cell=m3.utility.model.inventFactory({getMap:function(){return this.data.map},getTile:function(){return this.data.tile},getX:function(){return this.data.x},getY:function(){return this.data.y},setTile:function(t){return m3.model.tile.is(t)&&this.set("tile",t),this}}),m3.model.game=m3.utility.model.inventFactory({getPlayer:function(t){return this.data.players[t]},getPlayerCount:function(){return this.data.players.length},getPlayers:function(){return m3.utility.array.copy(this.data.players)},validators:{players:t=>((t=m3.utility.array.copy(t)).forEach(t=>{if(!m3.model.player.is(t))throw new Error("Please provide a valid player")}),t)}}),m3.model.map=m3.utility.model.inventFactory({createSlice:function(t,e,i,n){return m3.model.mapSlice.create({height:i,map:this,width:n,x:t,y:e})},getCell:function(t,e){if(this.cell[e])return this.cell[e][t]},getCells:function(){return this.cell.reduce((t,e)=>(t.push(...e),t),[])},getHeight:function(){return this.data.height},getWidth:function(){return this.data.width},setup:function(){this.cell=[];const t=this.data.height,e=this.data.width;for(let i=0;i<t;i++)for(let t=0;t<e;t++)this.cell[i]||(this.cell[i]=[]),this.cell[i][t]=m3.model.cell.create({map:this,x:t,y:i});return this},teardown:function(){return this.cell.forEach(t=>t.destroy()),this}}),m3.model.mapSlice=m3.utility.model.inventFactory((()=>{return{flip:function(){return this.cell=m3.utility.matrix.flip(this.cell),this},getCell:function(t,e){if(this.cell[e])return this.cell[e][t]},getCells:function(){return this.cell.reduce((t,e)=>(t.push(...e),t),[])},getCellCoordinates:function(t){return{x:t.getX()-this.data.x,y:t.getY()-this.data.y}},getHeight:function(){return this.data.height},getWidth:function(){return this.data.width},getX:function(){return this.data.x},getY:function(){return this.data.y},rotate:function(){return this.cell=m3.utility.matrix.rotate90(this.cell),this},setup:function(){return function(t){const e=t.map,i=e.getHeight(),n=e.getWidth();t.height<0&&(t.height=Math.abs(t.height)),t.width<0&&(t.width=Math.abs(t.width)),t.x<0&&(t.width+=t.x,t.x=0),t.x>=n&&(t.width=0,t.x=0),t.x+t.width>=n&&(t.width-=t.x+t.width-n),t.y<0&&(t.height+=t.y,t.y=0),t.y>=i&&(t.height=0,t.y=0),t.y+t.height>=i&&(t.height-=t.y+t.height-i)}(this.data),this.cell=function(t){const e=[],i=t.height,n=t.map,r=t.x,o=t.y,s=t.width;for(let t=0;t<i;t++)for(let i=0;i<s;i++){const s=n.getCell(i+r,t+o);e[t]||(e[t]=[]),e[t][i]=s}return e}(this.data),this.map=this.data.map,this},teardown:function(){return this.cell=void 0,this.map=void 0,this}}})()),m3.model.player=m3.utility.model.inventFactory({defaults:{score:0},getColor:function(){return this.data.color},getName:function(){return this.data.name},getScore:function(){return this.data.score},incrementScore:function(t){return this.data.score+=t,this.emit("change"),this},validators:{color:String,name:String,score:Number}}),m3.model.tile=m3.utility.model.inventSingletonFactory({getClaimType:function(){return m3.model.claimType.get(this.data.claimType)},getColor:function(){return this.data.color},getIcon:function(){return this.data.icon},getName:function(){return this.data.desc},getRandomWeight:function(){return this.data.randomWeight},isMatchable:function(){return Boolean(this.data.matchable)},isPlaceableInFog:function(){return Boolean(this.data.placeableInFog)},isPlaceableInWater:function(){return Boolean(this.data.placeableInWater)}}),m3.model.turn=m3.utility.model.inventFactory({getPlayer:function(){return this.data.player},validators:{player:t=>{if(!m3.model.player.is(t))throw new Error("Please provide a valid player");return t}}});